<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd"> 
<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
  Architecture
-->
<html lang="en">
  <head>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
    <meta content="FuseSource Training Camel Material" name="description"/>
    <meta content="FuseSource,Training,Camel,Material" name="keywords"/>
    <meta content="FuseSource Training Camel" name="author"/>
    <link type="text/css" rel="stylesheet" href="styles/impact/css/pygmentize.css"/>
    <link type="text/css" rel="stylesheet" href="styles/impact/css/site.css"/>
<style type='text/css'>
table { margin-top:1em; }
th { background-color:#F3F3F3; font-family:Verdana; vertical-align:text-top; }
td { border: 1px solid; padding:.5em; vertical-align:text-top; }
td.symbol { family:Symbol }
td p {margin:0px;}
</style>

    <title></title>
  </head>
  <body>
    <div id="content">
      <div class="wrapper">
<div class="body">
  <h1 id = "Table_of_Content">Table of Content</h1>

  <p><div class="toc"><ul style="list-style:none;">
    <li><a href="#Table_of_Content">Table of Content</a></li>
    <li><a href="#3__Content_Based_Router">3. Content Based Router</a></li>
    <li><ul style="list-style:none;">
      <li><a href="#3_1_Review_of_Solution">3.1 Review of Solution</a></li>
      <li><a href="#3_2_Building_and_Running_the_Solution">3.2 Building and Running the Solution</a></li>
      <li><a href="#3_3_Optional:_Deploying_the_Solution_in_Servicemix_4">3.3 Optional: Deploying the Solution in Servicemix 4</a></li>
      <li><a href="#3_4_Validating_the_Solution">3.4 Validating the Solution</a></li>
    </ul></li>
  </ul></p>

  <h1 id = "3__Content_Based_Router">3. Content Based Router</h1>

  <p>In this exercise, we will build and deploy some content-based routers. The first router 
  uses an XPath query to perform routing decisions on XML payload. The second router uses
  a header - containing the name of the file that initiates the route - to perform routing.</p>

  <p><img src="images/camel-cbr.png&rdquo; width="500&rdquo; height="300"/></p>

  <h2 id = "3_1_Review_of_Solution">3.1 Review of Solution</h2>

  <p>The files for this exercise are located in the directory <code>camel-exercises-cbr/</code>. Before 
  beginning the exercise, locate and open each of the files in the table below and preview 
  the file as instructed.</p>

  <table>
    <tr>
      <th>File</th>
      <th>Note</th>
      <th>Check</th>
    </tr>
    <tr>
      <td rowspan="2">
        <p><code>pom.xml</code></p>
      </td>
      <td>
        <p>Look at each of the dependencies in
        the <code>&lt;dependencies&gt;</code> section. Do you understand why each is required?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td>
        <p>Examine the configuration
        instructions for the <code>maven-bundle-plugin</code>. Do you understand how the
        OSGi bundle is being created?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td rowspan="2">
        <p><code>RouteByCurrencyRouter.java</code></p>
      </td>
      <td>
        <p>Examine the router; do you understand
        the flow of control?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td>
        <p>Why are the <code>InitializingBean</code>
        and <code>DisposableBean</code> interfaces implemented?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td>
        <p><code>RouteByFileNameRouter.java</code></p>
      </td>
      <td>
        <p>Examine the router; do you understand
        the flow of control?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td>
        <p><code>bundle-context.xml</code></p>
      </td>
      <td>
        <p>Do you understand how each route is
        being initialized?</p>
      </td>
      <td class="symbol">?</td>
    </tr>
    <tr valign="top">
      <td>
        <p><code>camelContext.xml</code></p>
      </td>
      <td>
        <p>Note how this file simply includes the
        bundle-context.xml file. This is to allow the camel:run plugin to re-use
        Spring configuration while running outside of an OSGi container.</p>
      </td>
      <td class="symbol">?</td>
    </tr>
  </table>

  <h2 id = "3_2_Building_and_Running_the_Solution">3.2 Building and Running the Solution</h2>

  <p>To build the solution use <code>mvn install</code>; to run the solution from the command-line, 
  use <code>mvn camel:run</code>.</p>

  <h2 id = "3_3_Optional:_Deploying_the_Solution_in_Servicemix_4">3.3 Optional: Deploying the Solution in Servicemix 4</h2>

  <p>To deploy the solution into Servicemix 4, install the <code>camel-exercises-cbr</code> feature from 
  the ServiceMix shell if you installed the entire exercise feature beforehand. Otherwise 
  follow the <code>readme.txt</code> file.</p>

  <pre><code>karaf@root&gt; features:install camel-exercises-cbr</code></pre>

  <h2 id = "3_4_Validating_the_Solution">3.4 Validating the Solution</h2>

  <p>The validation here is for the deployment inside Servicemix 4 but it works the same way when started with but then you donï¿½t need to copy any files and the output directory would be inside <code>./target/test-classes/camel/out</code> directory.
  The XPath router listens on the directory <code>/camel-exercises/cbr/xml/in</code> for XML files. Copy a sample file from the <code>./target/test-classes/camel/in/xml</code> directory into <code>/camel-exercises/cbr/xml/in</code>. It should &ldquo;disappear&rdquo; after a short interval, and be processed by the route and new files should appear in <code>/camel-exercises/cbr/xml/out</code> after a few seconds.</p>

  <p>The header-based router listens on the directory <code>/camel-exercises/cbr/csv/in</code>. Copy a sample file from the <code>./target/test-classes/camel/in/csv</code> directory. Again, it should &ldquo;disappear&rdquo; after a short interval, and be processed by the route and new files should appear in <code>/camel-exercises/cbr/csv/out</code> after a few seconds.</p>
</div>

      </div>
    </div>
  </body>
</html>
